name = "job-portal"
main = "src/index.ts"
compatibility_date = "2024-12-30"
compatibility_flags = ["nodejs_compat"]

# Static Assets configuration - serves the frontend build
[assets]
directory = "./dist/static"
binding = "ASSETS"
not_found_handling = "none"  # We handle 404s ourselves for SPA routing

# Development settings
[dev]
port = 8787
local_protocol = "http"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "job-portal-db"
database_id = "91018247-4a76-4065-9e65-b3efbb98723f"
migrations_dir = "../api/schema/migrations"

# R2 Bucket binding for file storage
[[r2_buckets]]
binding = "STORAGE"
bucket_name = "job-portal-storage"

# Environment variables
[vars]
ENVIRONMENT = "development"
JWT_EXPIRES_IN = "15m"
REFRESH_TOKEN_EXPIRES_IN = "7d"
EMAIL_FROM = "noreply@jobportal.com"
EMAIL_FROM_NAME = "JobPortal"
EMAIL_PROVIDER = "console"

# Production environment
[env.production]
name = "job-portal"
vars = { ENVIRONMENT = "production" }

[env.production.assets]
directory = "./dist/static"
binding = "ASSETS"
not_found_handling = "none"

# Staging environment
[env.staging]
name = "job-portal-staging"
vars = { ENVIRONMENT = "staging" }

[env.staging.assets]
directory = "./dist/static"
binding = "ASSETS"
not_found_handling = "none"

